#第一次python大作业的实验报告

 
##1.任务说明
- 本次大作业我设计了一个简易的,用于查询过去七天内任意地面气象台的多种天气信息的程序。程序设计的初衷是,在天文观测中,气象条件会很大程度地影响观测效果。通过整理分析某一地区过去的气象情况,有助于我们分析判断一个地区的天文观测条件。现在我们国家也有许多望远镜正在筹建当中,望远镜的选址更是需要考虑到多种气象因素,如气温(主要为温差),相对湿度(影响空气中的水汽含量,以及望远镜表面凝结形成露水多少),气压(同样会影响望远镜表面凝结形成露水的过程),风力风向(对望远镜镜身造成扰动),云量(吸收和散射光线),降水,大气视宁度,背景天光强度等等。后两者一般需要特定仪器长时间测量,在此我们主要研究前六个气象条件,这些气象数据可以在[国家气象科学数据中心](data.cma.cn)获得详细资料。  
- 本程序的主要功能包括:给出指定时间段(七天以内)的任意地点的气温,气压,相对湿度,风,降水和云量的统计数据,以及该时间段夜晚该地适合进行观测的天区(用赤道坐标系表示)。

##2.实验细节
- 本程序使用了来自[国家气象科学数据中心](data.cma.cn)的API:[中国地面气象站逐小时观测资料](http://data.cma.cn/Market/Detail/code/A.0012.0001/type/0.html)。官方介绍如下:
> http://api.data.cma.cn:8090/api?userId=<帐号>&pwd=<密码>&dataFormat=json&
    interfaceId=getSurfEleByTimeRangeAndStaID&dataCode=SURF_CHN_MUL_HOR&
    timeRange=<时间范围>&staIDs=<台站列表>&elements=Station_Id_C,Year,Mon,Day,Hour,<要素列表> 
其中，userId，pwd：分配给您的帐号和密码，从订单中获取
          dataFormat：返回的数据格式，目前仅支持json格式
          interfaceId：此数据的接口ID，值为getSurfEleByTimeRangeAndStaID
          dataCode：此数据的编码，中国地面气象站逐小时观测资料的编码为SURF_CHN_MUL_HOR
          timeRange：时间范围，支持最近7天的数据访问，格式为“[YYYYMMDDHHMISS,YYYYMMDDHHMISS]”
          staIDs：站号，支持1-30个站点，多个站点之间以“,”分隔，参见中国地面气象站点清单文档
          elements：返回数据字段，多个字段之间使用“,”分隔，其中:Station_Id_C, Year,Mon,Day,Hour为默认字段，Station_Id_C为站号，Year为资料时间的年，Mon为资料时间的月，Day为资料时间的日，Hour为资料时间的时，<要素列表>为您订单中订制的要素，参见中国地面气象站要素清单
          天气现象要素说明

- API所需参数包括:时间范围,台站列表,所需要素等。其中时间范围需要使用者自行输入(只需要输入到小时,分钟和秒钟不需要输入),台站要求以区站号形式输入,为了方便,本程序已经添加了自动转换的功能,使用者只需要输入想要查询的台站中文名称(如 合肥),程序将自动获取相应的区站号以及台站所在经纬度。要素列表默认将上文提到的六个气象条件都填入,根据使用者需求再选择性地进行显示。
- 主函数`homework.py`中只定义了一个函数`data_get`,主要功能为通过使用者输入的时间(2个),地点共三个参数,利用`request.get()`函数从API获取`dataraw`(即未经处理的数据)。
- 自定义模块文件`module_for_homework1.py`中主要定义了类`Weather`,这个类的构造函数有前面提到的`dataraw`数据和经纬度几个参数。所有的数据处理函数都放在`Weather`类中,如求最高/最低气温,累计降水量,某夜适合观测的天区等等。用户每在GUI中选择程序的某个功能时,`Weather`中的对应函数就会被调用执行并输出结果。
- 实验中遇到的困难1:对python的基本概念不熟悉,比如一开始单是要弄明白"类"这个概念就费了很大工夫。解决方法:请教计算机专业的同学,在网上看菜鸟教程等。
- 困难2:找不到中文字体,GUI界面文字没法调整。解决方法:最后根据网上的方法直接把windows中的宋体搬到linux系统来了(吐槽一下宋体在linux里名字叫做'song ti',之前输入'宋体'一直显示不出字体困扰了很久)。
- 困难3:自己写的模块文件在Spyder中检索不到,但是在jupyter notebook中却能正常import。解决方法:在网上了解的是如果主函数文件和自定义模块文件处于同一路径中应该可以直接import,但是Spyder中好像不行,具体原因也没有弄清楚,最后利用`sys.path.append()`函数直接将模块文件路径添加至`sys.path`中也算是解决了。
- 困难4:`dataraw`中关于云量的数据有很多问题,例如,完全无云的情况对应字典`"CLO_Cov"`(云覆盖率)的值不是"0"而是"",导致判断最大/最小云量的函数中有`test = float(self.hjson['DS'][x]['CLO_Cov'])`这样一行,总是报错。解决方法:在这行代码前面加入一个判断语句,将值为""的字典改为"0"。(此处遗留疑问:为什么在前面写`self.hjson['DS'][x]['CLO_Cov'].replace("","0")`没有效果)
##3.实验总结
- 大多数数据结果还是让人满意的,将数据和对应时间点(例如,最大气温为25摄氏度,出现时间为2021040915)结合现实,让使用者能看到直观的结果。比较不满意的还是上面提到过的云量数据,这个数据看起来气象台方面测量的效果就不好,可能参考价值不大。另一点值得注意的是,程序中有风力和最大风速两项提现风的指标,个人认为最大风速这个数据更有参考价值(最大风速:指给定时段内的10分钟平均风速的最大值。注意与极大风速区别,极大风速:给定时段内的瞬时风速的最大值，是个瞬时值。)
- 心得体会:python是非常棒的语言:),作为一名几乎没有基础的初学者,我能够在不算很长的时间里,艰难地写完这个大作业,很大一部分功劳要给python这些方便使用的包。在我写自己的模块的时候,也能够感受到python便利的特性。在这几天的敲代码过程中,每次遇到问题,询问他人,上网搜索,最后终于把问题解决的时候,感觉很有收获,也很有满足感。
- 注:前文有关天文观测条件的信息来自于*Site testing campaign for the Large Optical/infrared Telescope of
China: Overview* arXiv:2001.11378v2 [astro-ph.IM] 1 Feb 2020